<!DOCTYPE html><html lang="en"><head><meta name="generator" content="Hexo 3.8.0"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="您的好友魔力叉烧包已上线~_(┐「ε:)_❤"><meta name="keyword" content><link rel="shortcut icon" href="/img/favicon.ico"><title>小程序开发总结 - 魔力叉烧包</title><link rel="canonical" href="http://eleanormao.github.io/2019/06/01/weapp-20190601/"><link rel="stylesheet" href="https://cdn.bootcss.com/bootstrap/3.3.2/css/bootstrap.min.css"><link rel="stylesheet" href="/css/beantech.min.css"><link rel="stylesheet" href="/css/highlight.css"><link rel="stylesheet" href="/css/widget.css"><link rel="stylesheet" href="/css/rocket.css"><link rel="stylesheet" href="/css/signature.css"><link rel="stylesheet" href="/css/toc.css"><link href="https://cdn.staticfile.org/font-awesome/4.5.0/css/font-awesome.min.css" rel="stylesheet" type="text/css"><!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]--><script></script></head><body ontouchstart=""><style type="text/css">header.intro-header{background-image:url(/img/about.svg)}</style><header class="intro-header"><div id="signature"><div class="container"><div class="row"><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><div class="post-heading"><div class="tags"><a class="tag" href="/tags/diary" title="diary">diary</a> <a class="tag" href="/tags/javascript" title="javascript">javascript</a> <a class="tag" href="/tags/weapp" title="weapp">weapp</a></div><h1>小程序开发总结</h1><h2 class="subheading"></h2><span class="meta">Posted by Eleanor Mao on 2019-06-01</span></div></div></div></div></div></header><nav class="navbar navbar-default navbar-custom navbar-fixed-top"><div class="container-fluid"><div class="navbar-header page-scroll"><button type="button" class="navbar-toggle"><span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span></button> <a class="navbar-brand" href="/">魔力叉烧包! Eleanor Mao</a></div><div id="huxblog_navbar"><div class="navbar-collapse"><ul class="nav navbar-nav navbar-right"><li><a href="/">Home</a></li><li><a href="/archives">ARCHIVES</a></li><li><a href="/about/">About</a></li><li><a href="/tags/">tags</a></li><li><a target="_blank" href="https://github.com/EleanorMao">GITHUB</a></li></ul></div></div></div></nav><script>var $body=document.body,$toggle=document.querySelector(".navbar-toggle"),$navbar=document.querySelector("#huxblog_navbar"),$collapse=document.querySelector(".navbar-collapse");function handleMagic(e){0<$navbar.className.indexOf("in")?($navbar.className=" ",setTimeout(function(){$navbar.className.indexOf("in")<0&&($collapse.style.height="0px")},400)):($collapse.style.height="auto",$navbar.className+=" in")}$toggle.addEventListener("click",handleMagic)</script><article><div class="container"><div class="row"><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1 post-container"><h2><span id="前言提要">前言提要</span></h2><p>做了一波欲仙欲死的小程序<em>(:з」∠)</em>以下总结一波。</p><p>新做的小程序使用了<strong>Taro</strong>。其实我纠结了好久用mpvue还是wepy还是Taro。事实证明还好没用wepy = =。 差点就为了方便超代码而使用了wepy。很难受【。</p><p>选用<strong>Taro</strong>最大的原因是因为是它是react-like的，然后写起来果然很爽。嘻嘻。</p><p>当然实际写的时候也感觉自己非常的犹豫，感觉很不ok。下次开发时一定要事先了解业务的发展方向。这一期就很单纯的没有上数据管理【【【。纯用globalData控制数据。感觉自己很弱智<em>(:з」∠)</em></p><p>下次无论发生什么都要把数据管理上上去！！ &gt; &lt;</p><p>另外一提，之后准备使用Redux。因为感觉Taro对mobx的限制，有点Redux。→_→</p><p>既然Redux是早就支持了，所以我相信他是OJBK的嘻嘻。</p><h2><span id="调试">调试</span></h2><p>不知道为什么我的开发工具非常不OK。加了本地代理之后调用开放能力和上传就会疯狂报错。一开始还以为是框架有问题。xswl。</p><p>然鹅使用非本地代理就没有问题了。当然考虑到模拟器调试和真机调试是有一定区别的，所以手机配代理然后再手机上预览调试我觉得问题也不大。</p><p>但是我就非常觉得是ZanProxy的问题。有空找到底是为什么。</p><h2><span id="兼容">兼容</span></h2><p>在IOS9和IOS10上，小程序部分页面就会白屏掉。</p><p>在真机上debug之后发现报错是 <code>page[x] in not found.May be caused by :1. Forgot to add page route in app.json.2. Invoking Page() in async task.</code></p><p>因为这不是每个设备都有这个问题，所以定位是兼容问题。最后经过一番测试之后发现是 page 在 <code>app.json</code> 中配置顺序。 最好是二级页面写在一级页面后面，三级页面写在二级页面后面。但是也没有发现其中的准确的规律。只能疯狂调整路径配置的位置找到最佳的顺序。</p><h2><span id="分享">分享</span></h2><p>这个也是目前测试下来发现只有iPhone上有。</p><p>场景是这样。分享的路由带着一坨query。然而在页面跳转的过程中，query还是会挂在路由上。非常奇怪。</p><p>大概是这样:</p><p>理想： A.query -&gt; B -&gt; A 现实： A.query -&gt; B.query -&gt; A.query</p><p>在加上我把获取query的逻辑加在了<code>onShow</code>上，导致打开这个页面就会再获取最开始进来时的query。非常崩溃【【【</p><p>当然因为页面跳转的时候会经过<code>onLoad</code>。所以把逻辑移动之后修复了这个问题导致的bug。</p><h2><span id="自定义tabbar">自定义Tabbar</span></h2><p>实现了一下新(?)特性，自定义Tabbar。</p><p>当然最后发现需要这样写只会因为我弱智【【【 非常自闭</p><p>配置方法是在<code>app.json</code>中的把<code>tabBar</code>配置为<code>custom: true</code></p><p>然后增加一个文件夹<code>custom-tab-bar</code>。但是因为<code>Taro</code>没有对自定义Tabbar做很好的支持。</p><p>所以我的做法是新增一个<code>custom-tab-bar</code>文件夹，然后通过编辑配置，把这个文件夹编译并整个拷贝到编译后的文件夹里面。</p><p>然后我在写的过程中发现一个问题。当我切换页面时尝试切换高亮的tab时。只有图片被高亮了，文字没有被高亮。然后并没有找到是为什么。active的时候图片确实替换了，但是class没加上，很迷。</p><p>最后我的解决方案是，把图案和文字切在一张图片里面。</p><h2><span id="自定义navigatorbar">自定义NavigatorBar</span></h2><p>因为需要做胶囊。所以使用了自定义NavigatorBar。也是在<code>app.json</code>里面把<code>navigationStyle</code>设为<code>custom</code>。</p><p>但是要获取胶囊正确的位置就很迷了。</p><p>一开始我就直接在模拟器上用绝对定位，没有用任何的经验值和计算。然后再安卓和iPhoneX上胶囊就飘了。</p><p>然后我先是使用<code>wx.getMenuButtonBoundingClientRect()</code>获取右侧胶囊的位置，然后从而计算出我们需要的胶囊的位置。</p><p>【然后很迷的就是这个方法在真机调试上会爆炸，然后页面打不开。try catch都防不住【【【</p><p>最后经过我的一番真机测试，最终使用了经验值，使胶囊保持在一个正常的位置。</p><p>一个是NavigatorBar可以分为iPhone是44px，安卓48px。 另外一个是计算胶囊的top时：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; statusBarHeight &#125; = Taro.getSystemInfoSync()</span><br><span class="line"><span class="keyword">const</span> canUseMBBC = Taro.canIUse(<span class="string">'getMenuButtonBoundingClientRect'</span>)</span><br><span class="line"><span class="keyword">let</span> navTop = <span class="string">'26px'</span> <span class="comment">// 一个默认的经验值</span></span><br><span class="line"><span class="keyword">const</span> isIPhone = model.indexOf(<span class="string">'iPhone'</span>) &gt; <span class="number">-1</span></span><br><span class="line"><span class="keyword">const</span> isIPhoneX = isIPhone &amp;&amp; model.indexOf(<span class="string">'X'</span>) &gt; <span class="number">-1</span></span><br><span class="line"><span class="keyword">if</span> (canUseMBBC) &#123;</span><br><span class="line">	<span class="comment">// 顺便一提Taro里面没有封装wx.getMenuButtonBoundingClientRect，所以就直接用原生的</span></span><br><span class="line">	<span class="comment">// @ts-ignore</span></span><br><span class="line">	<span class="keyword">const</span> &#123;top, height&#125; = wx.getMenuButtonBoundingClientRect()</span><br><span class="line">	<span class="comment">// 如果是安卓的话就要减去状态栏的高度，不然就会因为top太小而看不见胶囊</span></span><br><span class="line">	<span class="comment">// 减去29是因为我们的胶囊设计高度是22px，然后右边的那个胶囊要下移个7px</span></span><br><span class="line">	navTop = (height - <span class="number">29</span>) + top - (isIPhone ? <span class="number">0</span> : statusBarHeight) + <span class="string">'px'</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">	navTop = isIPhone ? isIPhoneX ? <span class="string">'53px'</span> : <span class="string">'29px'</span> : <span class="string">'11px'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><ul class="pager"><li class="next"><a href="/2019/03/29/pixel/" data-toggle="tooltip" data-placement="top" title="像素">Next Post &rarr;</a></li></ul><div class="comment"><div id="disqus_thread" class="disqus-thread"></div></div></div><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1 sidebar-container"><section><h5><a href="/tags">FEATURED TAGS</a></h5><div class="tags"><a class="tag" href="/tags/diary" title="diary">diary</a> <a class="tag" href="/tags/javascript" title="javascript">javascript</a> <a class="tag" href="/tags/weapp" title="weapp">weapp</a></div></section><hr><h5>FRIENDS</h5><ul class="list-inline"><li><a href="#" target="_blank">No Friend</a></li></ul></div></div></div></article><script type="text/javascript">var disqus_shortname="www-chashaobao-net",disqus_identifier="http://eleanormao.github.io/2019/06/01/weapp-20190601/",disqus_url="http://eleanormao.github.io/2019/06/01/weapp-20190601/";!function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="//"+disqus_shortname+".disqus.com/embed.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(e)}()</script><script>function async(e,n){var t=document,a="script",r=t.createElement(a),c=t.getElementsByTagName(a)[0];r.src=e,n&&r.addEventListener("load",function(e){n(null,e)},!1),c.parentNode.insertBefore(r,c)}</script><script>async("https://cdn.bootcss.com/anchor-js/1.1.1/anchor.min.js",function(){anchors.options={visible:"hover",placement:"left",icon:"ℬ"},anchors.add().remove(".intro-header h1").remove(".subheading").remove(".sidebar-container h5")})</script><style>@media all and (min-width:800px){.anchorjs-link{position:absolute;left:-.75em;font-size:1.1em;margin-top:-.1em}}</style><footer><div class="container"><div class="row"><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><ul class="list-inline text-center"><li><a target="_blank" href="https://twitter.com/eleanormao"><span class="fa-stack fa-lg"><i class="fa fa-circle fa-stack-2x"></i> <i class="fa fa-twitter fa-stack-1x fa-inverse"></i></span></a></li><li><a target="_blank" href="http://weibo.com/1700934972/profile?rightmod=1&amp;wvr=6&amp;mod=personinfo&amp;is_all=1"><span class="fa-stack fa-lg"><i class="fa fa-circle fa-stack-2x"></i> <i class="fa fa-weibo fa-stack-1x fa-inverse"></i></span></a></li><li><a target="_blank" href="https://github.com/EleanorMao"><span class="fa-stack fa-lg"><i class="fa fa-circle fa-stack-2x"></i> <i class="fa fa-github fa-stack-1x fa-inverse"></i></span></a></li></ul><p class="copyright text-muted">Copyright &copy; Eleanor Mao 2019<br>Send me <a href="mailto:danningmao@outlook.com" title="Email">Email</a> <span style="display:inline-block;margin:0 5px"><i class="fa fa-envelope"></i> </span>| Theme by <a href="http://huangxuan.me">Hux</a></p></div></div></div></footer><script src="https://cdn.bootcss.com/jquery/3.0.0/jquery.min.js"></script><script src="https://cdn.bootcss.com/bootstrap/3.3.2/js/bootstrap.min.js"></script><script src="/js/hux-blog.min.js"></script><script>function async(e,n){var t=document,a="script",r=t.createElement(a),c=t.getElementsByTagName(a)[0];r.src=e,n&&r.addEventListener("load",function(e){n(null,e)},!1),c.parentNode.insertBefore(r,c)}</script><script>async("https://cdn.bootcss.com/fastclick/1.0.6/fastclick.min.js",function(){var c=document.querySelector("nav");c&&FastClick.attach(c)})</script><script>var _baId="6b4134eecce4a9849b989a2d36031acf",_hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?"+_baId;var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><a id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=1.0.0" async></script><script type="text/javascript" src="/js/toc.js?v=1.0.0" async></script></body></html>